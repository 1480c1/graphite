{
    "id" : "Segment"
    "description" : "A Segment object with extended a passes log containing \
                     positioned slot arrays"
    "properties" :
    {
        "version" :
        {
            "type" : "number",
            "title" : "Engine version",
            "description" : "Major.Minor.Bugfix version number of the engine \
                             that generated this object",
            "required" : true
        },

        "passes" :
        {
            "type" : "array",
            "title" : "Pass log",
            "description" : "A log of passes run to create this segment",
            "required" : true,
            "additionalItems" : false,
            "items" : 
            {
                "type" : "object",
                "title" : "Pass",
                "properties" :
                {
                    "id" : 
                    {
                        "type" : "integer",
                        "title" : "Pass number"
                        "description" : "The Pass as listed in dbg_engine code.\
                                         -1 is a synthetic pass representing \
                                         the bidi pass."
                        "required" : true,
                        "minimum" : -1
                    },
                    
                    "slots" :
                    {
                        "type" : "array",
                        "title" : "Slot stream",
                        "description" : "Slot stream at start of the pass.",
                        "required" : true,
                        "items" : 
                        {
                            "id" : "Slot",
                            "type" : "object",
                            "title" : "Slot",
                            "properties" :
                            {
                                "id" : 
                                { 
                                    "id" : "SlotRef",
                                    "type" : "integer",
                                    "title" : "Slot uuid"
                                    "description" : "A unique ID for tracking Slot movement"
                                    "minimim" : 0, 
                                    "maximum" : 65535
                                },
                                
                                "gid" : 
                                { 
                                    "type" : "integer", 
                                    "minimum" : 0, 
                                    "maxmimum" : 65535, 
                                    "required" : true 
                                },
                                    
                                "charinfo" : 
                                { 
                                    "type" : "object",
                                    "title" : "Char info relations",
                                    "required" : true,
                                    "properties" : 
                                    {
                                        "original" : 
                                        { 
                                            "id" : "Index",
                                            "type" : "integer",
                                            "required" : true,
                                        },
                                        
                                        "before" : { "$ref" : "Index" },
                                        
                                        "after" : { "$ref" : "Index" }
                                    } 
                                },
                                
                                "origin" : 
                                {
                                    "id" : "Point",
                                    "type" : "array",
                                    "required" : true,
                                    "title" : "position",
                                    "description" : "A 2-tuple ordered x, y"
                                    "items" : 
                                    [ 
                                        { "type" : "number" }, 
                                        { "type" : "number" }
                                    ]
                                },
                                
                                "shift" : { "$ref" : "Point" },
                                
                                "advance" : { "$ref" : "Point" },
                                
                                "insert" : 
                                { 
                                    "type" : "boolean",
                                    "title" : "Insert before", 
                                    "required" : true 
                                },
                                
                                "break" : 
                                { 
                                    "id" : "BreakWeight",
                                    "type" : "integer",
                                    "title" : "Break Weight of associated character", 
                                    "required" : true, 
                                    "minimum" : -50, 
                                    "maximum" : 50                        
                                },
                                
                                "bidi" : 
                                { 
                                    "type" : "integer", 
                                    "title" : "Bidirection level"
                                    "minimum" : 0,
                                    "maxmimum" : 63,
                                },
                                
                                "justification" : { "type" : "number", "title" : "Justification width" },
                                
                                "parent" : 
                                {
                                    "type" : "object"
                                    "description" : "SlotRef to this slots \
                                                     parent and offset from \
                                                     the parent's origin"
                                    "properties" :
                                    {
                                        "id" : { "$ref" : "SlotRef" },
                                        "level" : { "type" : "integer", "minimum" : 0 },
                                        "offset" : { "$ref" : "Point" }
                                    }
                                },
                                
                                "user" :
                                {
                                    "type" : "array",
                                    "title" : "User attributes array",
                                    "required" : true,
                                    "items" : 
                                    { 
                                        "type" : "integer", 
                                        "minimim" : 0, 
                                        "maximum" : 65535
                                    } 
                                },
                                
                                "children" : 
                                { 
                                    "type" : "array", 
                                    "items" : { "$ref" : "SlotRef" } 
                                }              
                            }
                        }
                    },
                    
                    "constraint" : { "type" : "boolean", "title" : "Pass constraint result" }, 
                   
                    "rules" :
                    {
                        "type" : "array",
                        "title" : "Rule log",
                        "required" : true,
                        "items" : 
                        {
                            "id" : "RuleEvent",
                            "type" : "object",
                            "title" : "Rule event",
                            "properties" : 
                            {
                                "considered" :
                                {
                                    "type" : "array",
                                    "title" : "Rules considered",
                                    "required" : true,
                                    "items" :
                                    {
                                        "id" : "Rule"
                                        "type" : "object"
                                        "properties" :
                                        {
                                            "id" :
                                            { 
                                                "type" : "integer",
                                                "required" : true,
                                                "minimum" : -1
                                            },
                                            
                                            "failed" : { "type" : "boolean", "required" : true },
                                
                                            "input" : 
                                            { 
                                                "type" : "object",
                                                "title" : "Input slot range",
                                                "required" : true,
                                                "properties" : 
                                                {
                                                    "start" : { "$ref" : "SlotRef" },
                                                    "length" : 
                                                    { 
                                                        "type" : "integer", 
                                                        "required" : true, 
                                                        "minimum" : 0 
                                                    },
                                                }
                                            }
                                        }
                                   }    
                                },
                                
                                "output" :
                                {
                                    "type" : "object",
                                    "title" : "Output slot cursor and slots"
                                    "required" : true,
                                    "properties" :
                                    {
                                        "slots" :
                                        {
                                            "type" : "array",
                                            "title" : "Rule output slots",
                                            "description" : "Sub sequence of the \
                                                             output slots stream.",
                                            "required" : true, 
                                            "items" : { "$ref" : "Slot" }
                                        },
                                        "cursor" : { "$ref" : "SlotRef" }
                                    }
                                }
                            }
                        } 
                    }
                }
            }
        },
        
        "output" :
        {
            "type" : "array",
            "title" : "Final positioned output slots",
            "description" : "Slot stream after the final pass has run.",
            "required" : true, 
            "items" : { "$ref" : "Slot" }
        }

        "advance" : { "$ref" : "Advance" },
               
        "chars" :
        {
            "type" : "array",
            "title" : "CharInfo array",
            "description" : "A array of CharInfo objects referneced by the \
                             slots"
            "items" : 
            {
                "id" : "CharInfo",
                "type" : "object"
                "properties" :
                {
                    "offset" : { "$ref" : "Index" },
                    
                    "unicode" : 
                    { 
                        "type" : "integer", 
                        "required" : true, 
                        "minimum" : 0, 
                        "maximum" : 1114111
                    },
                    
                    "break" : { "$ref" : "BreakWeight" },

                    "flags" :
                    {
                        "type" : "integer",
                        "required" : true,
                        "minimum" : 0,
                        "maximum" : 3
                    },
                    
                    "slot" : 
                    {
                        "type" : "object",
                        "title" : "Slot relations"
                        "required" : true
                        "properties" : 
                        {
                            "before" : { "$ref" : "Index" },
                            "after" : { "$ref" : "Index" },
                        }
                    }
                }
            }
        }
    }
}

