{
    "id" : "Segment"
    "description" : "A Segment object with extended a passes log containing \
                     positioned slot arrays"
    "properties" :
    {
        "version" :
        {
            "type" : "number",
            "title" : "Engine version",
            "description" : "Version number of the engine that generated \
                             this object",
            "required" : true
        },

        "passes" :
        {
            "type" : "array",
            "title" : "Pass log",
            "description" : "A log of passes run to create this segment",
            "required" : true,
            "additionalItems" : false,
            "items" : 
            {
                "type" : "object",
                "title" : "Pass",
                "properties" :
                {
                    "id" : 
                    {
                        "id" : "Index",
                        "type" : "integer",
                        "required" : true,
                        "minimum" : 0
                    },
                    
                    "slots" :
                    {
                        "type" : "array",
                        "title" : "Slot stream",
                        "description" : "Slot stream at start of the pass.",
                        "required" : true,
                        "items" : 
                        {
                            "id" : "Slot",
                            "type" : "object",
                            "title" : "Slot",
                            "properties" :
                            {
                                "id" : { "type" : "integer", "minimim" : 1 },
                                
                                "gid" : 
                                { 
                                    "type" : "integer", 
                                    "minimum" : 0, 
                                    "maxmimum" : 65535, 
                                    "required" : true 
                                },
                                    
                                "charinfo" : 
                                { 
                                    "type" : "object",
                                    "title" : "Char info relations",
                                    "required" : true,
                                    "properties" : 
                                    {
                                        "original" : { "$ref" : "Index" },
                                        
                                        "before" : { "$ref" : "Index" },
                                        
                                        "after" : { "$ref" : "Index" }
                                    } 
                                },
                                
                                "bidi" : 
                                { 
                                    "type" : "integer", 
                                    "title" : "Bidirection level"
                                    "minimum" : 0,
                                    "maxmimum" : 63,
                                },
                                
                                "origin" : 
                                {
                                    "id" : "Point",
                                    "type" : "array",
                                    "required" : true,
                                    "title" : "position",
                                    "description" : "A 2-tuple ordered x, y"
                                    "items" : 
                                    [ 
                                        { "type" : "number" }, 
                                        { "type" : "number" }
                                    ]
                                },
                                
                                "advance" : { "$ref" : "Point" },
                                
                                "insertBefore" : 
                                { 
                                    "type" : "boolean", 
                                    "required" : true 
                                },
                                
                                "parent" : 
                                {
                                    "type" : "object"
                                    "description" : "Slot index to this slots \
                                                     parent and offset from \
                                                     the parent's origin"
                                    "id" : { "$ref" : "Index" },
                                    "offset" : { "$ref" : "Point" }
                                }
                                
                                "children" : 
                                { 
                                    "type" : "array", 
                                    "items" : { "$ref" : "Index" } 
                                }              
                            }
                        }
                    },
                     
                    "rules" :
                    {
                        "type" : "array",
                        "title" : "Rule log",
                        "required" : true,
                        "items" : 
                        {
                            "id" : "RuleEvent",
                            "type" : "object",
                            "title" : "Rule event",
                            "properties" : 
                            {
                                "trigger" : 
                                { 
                                    "enum" : ["match", "nomatch", "maxloop"], 
                                    "required" : true 
                                },
                                
                                "id" : { "$ref" : "Index" },
                                
                                "input" : 
                                { 
                                    "type" : "object",
                                    "title" : "Input slot range",
                                    "required" : true,
                                    "properties" : 
                                    {
                                        "offset" : { "$ref" : "Index" },
                                        "length" : 
                                        { 
                                            "type" : "integer", 
                                            "required" : true, 
                                            "minimum" : 0 
                                        },
                                    }
                                },
                                
                                "output" :
                                {
                                    "type" : "array",
                                    "title" : "Rule output slots",
                                    "description" : "Sub sequence of the \
                                                     output slots stream.",
                                    "required" : true, 
                                    "items" : { "$ref" : "Slot" }
                                }
                            }
                        } 
                    }
                }
            }
        },
        
        "advance" : { "$ref" : "Advance" },
               
        "chars" :
        {
            "type" : "array",
            "title" : "CharInfo array",
            "description" : "A array of CharInfo objects referneced by the \
                             slots"
            "items" : 
            {
                "id" : "CharInfo",
                "type" : "object"
                "properties" :
                {
                    "base" : { "$ref" : "Index" },
                    "unicode" : 
                    { 
                        "type" : "integer", 
                        "required" : true, 
                        "minimum" : 0, 
                        "maximum" : 1114111
                    },
                    "breakWeight" : 
                    { 
                        "type" : "integer", 
                        "required" : true, 
                        "minimum" : -50, 
                        "maximum" : 50                        
                    },
                    "slot" : 
                    {
                        "type" : "object",
                        "title" : "Slot relations"
                        "required" : true
                        "properties" : 
                        {
                            "before" : { "$ref" : "Index" },
                            "after" : { "$ref" : "Index" },
                        }
                    }
                }
            }
        }
    }
}

